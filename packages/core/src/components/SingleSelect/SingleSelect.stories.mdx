import { useState } from 'react';
import { PreviewContent } from '@medly-components/utils';
import { ArrowDropDownCircleIcon, StarIcon } from '@medly-components/icons';
import { SingleSelect } from './SingleSelect';
import { boolean, select, text } from '@storybook/addon-knobs';
import { Preview, Story, Meta, Props } from '@storybook/addon-docs/blocks';
import { variants, options, sizes, ThemeInterface, OptionProps } from './SingleSelect.stories.tsx';

<Meta title="Core" component={SingleSelect} parameters={{ jest: ['SingleSelect.test.tsx'] }} />

# SingleSelect

The `SingleSelect` component allows you to pick a value from a list of options. You can ideally use it when the list of options is more than five otherwise consider using `RadioGroup`.

<Preview withToolbar>
    <Story name="SingleSelect">
        {() => {
            const [value, setValue] = useState('Some 1');
            return (
                <SingleSelect
                    options={options}
                    value={value}
                    onChange={setValue}
                    size={select('Size', sizes, 'M')}
                    isSearchable={boolean('Is Searchable', false)}
                    variant={select('Variant', variants, 'filled')}
                    disabled={boolean('Disabled', false)}
                    fullWidth={boolean('Full Width', false)}
                    required={boolean('Required', false)}
                    label={text('Label', 'Pharmacy')}
                    placeholder="Select Pharmacy"
                    helperText={text('Helper Text', 'Pharmacy')}
                    errorText={text('Error Text', '')}
                    minWidth={text('Min Width', '20rem')}
                    maxWidth={text('Max Width', '')}
                    maxHeight={text('Max Height', '')}
                    includesNestedOptions={boolean('Includes nested option', true)}
                />
            );
        }}
    </Story>
</Preview>

## Variants

Three variants are available `filled`, `outlined` & `flat`.

> **Note**: The `flat` variant does not support the following props; `size`, `required` and `isSearchable`. Also, its not advisable to use `helperText` and `errorText` props in `flat` variant.    

<Preview>
    <PreviewContent>
        {() => {
            const [filledValue, setFilledValue] = useState('Dummy4 option'),
                [outlinedValue, setOutlinedValue] = useState('Dummy4 option'),
                [flatValue, setFlatValue] = useState('Dummy4 option');
            return (
                <>
                    <SingleSelect
                        variant="filled"
                        size="S"
                        options={options}
                        value={filledValue}
                        onChange={setFilledValue}
                        label="Pharmacy"
                        helperText="Filled Variant"
                        includesNestedOptions
                    />
                    <SingleSelect
                        variant="outlined"
                        size="S"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        helperText="Outlined Variant"
                        includesNestedOptions
                    />
                    <SingleSelect
                        variant="flat"
                        options={options}
                        value={flatValue}
                        onChange={setFlatValue}
                        label="Pharmacy"
                        helperText="Flat Variant"
                        includesNestedOptions
                    />
                </>
            );
        }}
    </PreviewContent>
</Preview>

## Error validation

As mentioned in the `TextField` component, you can pass either  `errorText` or `validator` prop to show the custom message. If you have not passed any of these props, the default html5 error validation message appears.

<Preview>
    <PreviewContent>
        {() => {
            const [filledValue, setFilledValue] = useState('Dummy4 option'),
                [outlinedValue, setOutlinedValue] = useState('Dummy4 option'),
                [flatValue, setFlatValue] = useState('Dummy4 option');
            return (
                <>
                    <SingleSelect
                        variant="filled"
                        size="S"
                        errorText="Something wrong"
                        options={options}
                        value={filledValue}
                        onChange={setFilledValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                    <SingleSelect
                        variant="outlined"
                        size="S"
                        errorText="Something wrong"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                    <SingleSelect
                        variant="flat"
                        errorText="Something wrong"
                        options={options}
                        value={flatValue}
                        onChange={setFlatValue}
                        label="Pharmacy"
                        helperText="Flat Variant"
                        includesNestedOptions
                    />
                </>
            );
        }}
    </PreviewContent>
</Preview>

### Error validation with Helper Tooltip
<Preview>
    <PreviewContent>
        {() => {
            const [filledValue, setFilledValue] = useState('Dummy4 option'),
                [outlinedValue, setOutlinedValue] = useState('Dummy4 option');
            return (
                <>
                    <SingleSelect
                        variant="filled"
                        errorText="Something wrong"
                        options={options}
                        value={filledValue}
                        onChange={setFilledValue}
                        label="Pharmacy"
                        includesNestedOptions
                        showTooltipForHelperAndErrorText
                    />
                    <SingleSelect
                        variant="outlined"
                        errorText="Something wrong"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        includesNestedOptions
                        showTooltipForHelperAndErrorText
                    />
                </>
            );
        }}
    </PreviewContent>
</Preview>

### With Icons

You can provide a prefix icon, which always takes the label color.

<Preview>
    <PreviewContent>
        {() => {
            const [filledValue, setFilledValue] = useState('Dummy4 option'),
                [outlinedValue, setOutlinedValue] = useState('Dummy4 option');
            return (
                <>
                    <SingleSelect
                        prefix={StarIcon}
                        variant="filled"
                        options={options}
                        value={filledValue}
                        onChange={setFilledValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                    <SingleSelect
                        prefix={StarIcon}
                        variant="outlined"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                </>
            );
        }}
    </PreviewContent>
</Preview>

Additionally, you can also provide a suffix icon, which also takes the label color.

<Preview>
    <PreviewContent>
        {() => {
            const [filledValue, setFilledValue] = useState('Dummy4 option'),
                [outlinedValue, setOutlinedValue] = useState('Dummy4 option');
            return (
                <>                 
                    <SingleSelect
                        suffix={ArrowDropDownCircleIcon}
                        variant="filled"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                    <SingleSelect
                        suffix={ArrowDropDownCircleIcon}
                        variant="outlined"
                        options={options}
                        value={outlinedValue}
                        onChange={setOutlinedValue}
                        label="Pharmacy"
                        includesNestedOptions
                    />
                  
                </>
            );
        }}
    </PreviewContent>
</Preview>

## Keyboard support

This component supports keyboard navigation when in focus.

| Key         | Function                              |
| ----------- | ------------------------------------- |
| Down Arrow  | Moves focus to the next option        |
| Up Arrow    | Moves focus to the previous option    |
| Right Arrow | Moves focus to nested options         |
| Left Arrow  | Moves focus out of the nested options |
| Enter       | Select the focused option             |

### Nested Options

If you want to use nested options, then set `includesNestedOptions` prop to true and pass nested array of `{label:'' , value:''}` in the options list like below.

```tsx
const options = [
    { value: 'Dummy1 option', label: 'Dummy1 option' },
    {
        label: 'Dummy2 option',
        value: [
            { value: 'Some 1', label: 'Some 1' },
            { value: 'Some 2', label: 'Some 2' }
        ]
    },
    { value: 'Dummy3 option', label: 'Dummy3 option' }
];
```

## Props

This component offers the following props mentioned in the table below:

<Props of={SingleSelect} />

## Option Props

This component offers the following option props mentioned in the table below:

<Props of={OptionProps} />

## SelectTheme

This theme is shared between single select and multi select.

<Props of={ThemeInterface} />
